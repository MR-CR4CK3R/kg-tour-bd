{% extends "layout.html" %}
{% block content %}
<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card card-custom p-3 border-warning">
            <h4 class="text-neon mb-3"><i class="fas fa-gavel"></i> SUBMIT APPEAL</h4>
            
            <form method="POST" enctype="multipart/form-data">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="mb-3">
                    <label class="form-label text-white small">Select Category</label>
                    <select name="category" class="form-select bg-dark text-white border-secondary" required>
                        <option value="" selected disabled>-- Select Reason --</option>
                        
                        {% if user.is_banned %}
                        <option value="False Ban" class="text-danger fw-bold">ðŸš« False Ban Appeal</option>
                        {% endif %}

                        <option value="Match Result Dispute">Match Result Dispute</option>
                        <option value="Prize / Payment Issue">Prize / Payment Issue</option>
                        <option value="Unfair Disqualification">Unfair Disqualification</option>
                        <option value="Room / Match Issue">Room / Match Issue</option>
                        <option value="Cheating Report Appeal">Cheating Report Appeal</option>
                        <option value="Account Issue">Account Issue</option>
                        <option value="Admin / Moderator Issue">Admin / Moderator Issue</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label text-white small">Description</label>
                    <textarea name="description" class="form-control bg-dark text-white border-secondary" rows="4" placeholder="Explain your issue..." required></textarea>
                </div>

                <div class="mb-3">
                    <p class="text-white small mb-2">Do you want to attach any image?</p>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="has_image_check" id="imgYes" value="yes" onclick="toggleImage(true)">
                        <label class="form-check-label text-info" for="imgYes">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="has_image_check" id="imgNo" value="no" onclick="toggleImage(false)" checked>
                        <label class="form-check-label text-secondary" for="imgNo">No</label>
                    </div>
                </div>

                <div class="mb-3" id="imageInputBox" style="display: none;">
                    <label class="form-label text-white small">Upload Screenshot</label>
                    <input type="file" name="proof_image" class="form-control bg-dark text-white border-secondary" accept="image/*">
                </div>

                <button type="submit" class="btn btn-warning w-100 fw-bold mt-2">SUBMIT APPEAL</button>
            </form>
        </div>
    </div>

    <div class="col-md-6">
        <h5 class="text-white mb-3"><i class="fas fa-history"></i> APPEAL HISTORY</h5>
        <div style="max-height: 600px; overflow-y: auto;">
            {% if appeals %}
                {% for app in appeals %}
                <div class="card bg-dark border-secondary mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span class="badge bg-info text-dark">{{ app.category }}</span>
                        {% if app.admin_reply %}<span class="badge bg-success">Replied</span>
                        {% else %}<span class="badge bg-secondary">Pending</span>{% endif %}
                    </div>
                    <div class="card-body">
                        <p class="text-light small mb-1"><b>You:</b> {{ app.description }}</p>
                        <small class="text-muted" style="font-size: 10px;">{{ app.time[:16] }}</small>
                        
                        {% if app.admin_reply %}
                        <div class="mt-3 p-2 border border-success rounded bg-black">
                            <h6 class="text-success small mb-1">Admin Reply:</h6>
                            <p class="text-white small mb-0">{{ app.admin_reply }}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted text-center mt-5">No appeals found.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
    function toggleImage(show) {
        document.getElementById('imageInputBox').style.display = show ? 'block' : 'none';
    }
</script>
{% endblock %}
